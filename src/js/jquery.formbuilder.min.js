/*! jQuery.formbuilder */
(function(e){e.fn.formbuilder=function(t){var n={save_url:false,load_url:false,control_box_target:false,serialize_prefix:"frmb",css_ol_sortable_class:"ol_opt_sortable",field_types:{input_text:{label:i18n.t("formbuilder_label_text_field"),types:{text:"Text",email:"Email",url:"URL",tel:"Telephone"}},textarea:{label:i18n.t("formbuilder_label_paragraph_field")},file:{label:i18n.t("formbuilder_label_file_field")},checkbox:{label:i18n.t("formbuilder_label_checkboxes_field")},radio:{label:i18n.t("formbuilder_label_radio_field")},select:{label:i18n.t("formbuilder_label_select_list_field")}},messages:{save:i18n.t("formbuilder_message_save"),add_new_field:i18n.t("formbuilder_message_add_new_field"),title:i18n.t("formbuilder_message_title"),text_field:i18n.t("formbuilder_message_text_field"),label:i18n.t("formbuilder_message_label"),paragraph_field:i18n.t("formbuilder_message_paragraph_field"),select_options:i18n.t("formbuilder_message_select_options"),add:i18n.t("formbuilder_message_add"),checkbox_group:i18n.t("formbuilder_message_checkbox_group"),remove_message:i18n.t("formbuilder_message_remove_confirm"),remove:i18n.t("formbuilder_message_remove"),radio_group:i18n.t("formbuilder_message_radio_group"),selections_message:i18n.t("formbuilder_message_allow_multiple_seelctions"),hide:i18n.t("formbuilder_message_hidde"),required:i18n.t("formbuilder_message_required"),show:i18n.t("formbuilder_message_show"),file_field:i18n.t("formbuilder_message_file_field")},loaded:function(){},saving:function(){},saved:function(){}};var r=e.extend(n,t);var s="frmb-"+e("ul[id^=frmb-]").length++;return this.each(function(){var t=e(this).append('<ul id="'+s+'" class="frmb"></ul>').find("ul").sortable();var n="",o="",u=1,a,f;t.addClass(s);var l=function(n){var i="";var o="";var a="";var f=s+"-control-box";var l=s+"-save-button";i+='<option value="0" disabled selected>'+r.messages.add_new_field+"</option>";for(key in r.field_types){i+='<option value="'+key+'">'+r.field_types[key].label+"</option>"}o='<select id="'+f+'" class="frmb-control form-control">'+i+"</select>";a='<button type="submit" id="'+l+'" class="frmb-submit btn btn-primary">'+r.messages.save+"</button>";if(!n){e(t).before(o)}else{e(n).append(o)}e(t).after(a);e("#"+l).click(function(){r.saving.call(this);T.call(this);return false});e("#"+f).change(function(){h(e(this).val());e(this).val(0).blur();e("html, body").animate({scrollTop:e("#frm-"+(u-1)+"-item").offset().top},500);return false})};var c=function(t){var n="";var r=false;e(t).each(function(){if(this.cssClass==="checkbox"){r=[this.title];n=[];e.each(this.values,function(){n.push([this.value,this.baseline])})}else if(this.cssClass==="radio"){r=[this.title];n=[];e.each(this.values,function(){n.push([this.value,this.baseline])})}else if(this.cssClass==="select"){r=[this.title,this.multiple];n=[];e.each(this.values,function(){n.push([this.value,this.baseline])})}else{if(this.hasOwnProperty("type")){r=this.type}n=[this.values]}h(this.cssClass,n,r,this.required)})};var h=function(e,t,r,i){n="";o=e;if(typeof t==="undefined"){t=""}switch(e){case"input_text":p(t,r,i);break;case"file":v(t,r,i);break;case"textarea":d(t,i);break;case"checkbox":m(t,r,i);break;case"radio":y(t,r,i);break;case"select":w(t,r,i);break}};var p=function(e,t,i){n+='<div class="frm-fld"><label>'+r.messages.label+"</label>";n+='<input class="fld-title form-control" id="title-'+u+'" type="text" value="'+e+'" /></div>';n+='<div class="frm-fld"><label>Type</label>';if(typeof t=="undefined"||t==false){t="text"}n+='<select id="input-type-'+u+'">';for(key in r.field_types.input_text.types){n+='<option value="'+key+'"'+(t==key?" selected":"")+">"+r.field_types.input_text.types[key]+"</option>"}n+="</select></div>";a="";S(r.field_types.input_text.label,n,i,a)};var d=function(e,t){n+="<label>"+r.messages.label+"</label>";n+='<input type="text" class="form-control" value="'+e+'" />';a="";S(r.field_types.textarea.label,n,t,a)};var v=function(e,t,i){n+='<div class="frm-fld"><label>'+r.messages.label+"</label>";n+='<input class="fld-title form-control" id="title-'+u+'" type="text" value="'+e+'" /></div>';a="";S(r.field_types.file.label,n,i,a)};var m=function(t,s,o){var u="";if(typeof s==="object"){u=s[0]}n+='<div class="chk_group">';n+='<div class="frm-fld"><label>'+r.messages.title+"</label>";n+='<input type="text" name="title" class="form-control" value="'+u+'" /></div>';n+='<div class="false-label">'+r.messages.select_options+"</div>";n+='<div class="fields">';n+='<div><ol class="'+r.css_ol_sortable_class+'">';if(typeof t==="object"){for(i=0;i<t.length;i++){n+=g(t[i])}}else{n+=g("")}n+='<li class="add-area"><a href="#" class="add add_ck">'+r.messages.add+"</a></li>";n+="</ol></div>";n+="</div>";n+="</div>";a="";S(r.messages.checkbox_group,n,o,a);e("."+r.css_ol_sortable_class).sortable()};var g=function(e){var t=false;var i="";if(typeof e==="object"){i=e[0];t=e[1]==="false"||e[1]==="undefined"?false:true}n="<li>";n+="<div>";n+='<input type="checkbox"'+(t?' checked="checked"':"")+" />";n+='<input type="text" class="form-control" value="'+i+'" />';n+='<a href="#" class="remove" title="'+r.messages.remove_message+'">'+r.messages.remove+"</a>";n+="</div></li>";return n};var y=function(t,s,o){var f="";if(typeof s==="object"){f=s[0]}n+='<div class="rd_group">';n+='<div class="frm-fld"><label>'+r.messages.title+"</label>";n+='<input type="text" class="form-control" name="title" value="'+f+'" /></div>';n+='<div class="false-label">'+r.messages.select_options+"</div>";n+='<div class="fields">';n+='<div><ol class="'+r.css_ol_sortable_class+'">';if(typeof t==="object"){for(i=0;i<t.length;i++){n+=b(t[i],"frm-"+u+"-fld")}}else{n+=b("","frm-"+u+"-fld")}n+='<div class="add-area"><a href="#" class="add add_rd">'+r.messages.add+"</a></div>";n+="</ol></div>";n+="</div>";n+="</div>";a="";S(r.messages.radio_group,n,o,a);e("."+r.css_ol_sortable_class).sortable()};var b=function(e,t){var i=false;var s="";if(typeof e==="object"){s=e[0];i=e[1]==="false"||e[1]==="undefined"?false:true}n="<li>";n+="<div>";n+='<input type="radio"'+(i?' checked="checked"':"")+' name="radio_'+t+'" />';n+='<input type="text" class="form-control" value="'+s+'" />';n+='<a href="#" class="remove" title="'+r.messages.remove_message+'">'+r.messages.remove+"</a>";n+="</div></li>";return n};var w=function(t,s,o){var u=false;var f="";if(typeof s==="object"){f=s[0];u=s[1]==="true"||s[1]==="checked"?true:false}n+='<div class="opt_group">';n+='<div class="frm-fld"><label>'+r.messages.title+"</label>";n+='<input type="text" class="form-control" name="title" value="'+f+'" /></div>';n+="";n+='<div class="false-label">'+r.messages.select_options+"</div>";n+='<div class="fields">';n+='<input type="checkbox" name="multiple"'+(u?'checked="checked"':"")+">";n+='<label class="auto">'+r.messages.selections_message+"</label>";n+='<div><ol class="'+r.css_ol_sortable_class+'">';if(typeof t==="object"){for(i=0;i<t.length;i++){n+=E(t[i],u)}}else{n+=E("",u)}n+='<div class="add-area"><a href="#" class="add add_opt">'+r.messages.add+"</a></div>";n+="</ol></div>";n+="</div>";n+="</div>";a="";S(r.messages.select,n,o,a);e("."+r.css_ol_sortable_class).sortable()};var E=function(e,t){return t?g(e):b(e)};var S=function(i,s,a,f){if(a){a=a==="true"?true:false}var l="";l+='<li id="frm-'+u+'-item" class="'+o+'">';l+='<div class="legend">';l+='<a id="frm-'+u+'" class="toggle-form" href="#">'+r.messages.hide+"</a> ";l+='<a id="del_'+u+'" class="del-button delete-confirm" href="#" title="'+r.messages.remove_message+'"><span>'+r.messages.remove+"</span></a>";l+='<strong id="txt-title-'+u+'">'+i+"</strong></div>";l+='<div id="frm-'+u+'-fld" class="frm-holder">';l+='<div class="frm-elements">';l+='<div class="frm-fld"><label for="required-'+u+'">'+r.messages.required+"</label>";l+='<input class="required" type="checkbox" value="1" name="required-'+u+'" id="required-'+u+'"'+(a?' checked="checked"':"")+" /></div>";l+=n;l+="</div>";l+="</div>";l+="</li>";e(t).append(l);e("#frm-"+u+"-item").hide();e("#frm-"+u+"-item").animate({opacity:"show",height:"show"},"slow");u++};t.on("click",".remove",function(t){t.preventDefault();e(this).parents("li:eq(0)").animate({opacity:"hide",height:"hide",marginBottom:"0px"},"fast",function(){e(this).remove()});return false});if(r.load_url){e.getJSON(r.load_url,function(e){f=e.form_id;c(e.form_structure);r.loaded(e);var t=l(r.control_box_target)})}else{var x=l(r.control_box_target)}t.on("click",".toggle-form",function(t){t.preventDefault();var n=e(this).parents("li:eq(0)").find(".frm-holder");if(n.is(":visible")){e(this).removeClass("open").addClass("closed").html(r.messages.show);n.animate({opacity:"hide",height:"hide"},"slow")}else{e(this).removeClass("closed").addClass("open").html(r.messages.hide);n.animate({opacity:"show",height:"show"},"slow")}return false});t.on("click",".delete-confirm",function(t){t.preventDefault();if(confirm(e(this).attr("title"))){e(this).parents("li:eq(0)").animate({opacity:"hide",height:"hide",marginBottom:"0px"},"slow",function(){e(this).remove()})}return false});t.on("click",".add_ck",function(t){t.preventDefault();e(this).parent().before(g());return false});t.on("click",".add_opt",function(t){t.preventDefault();e(this).parent().before(E("",false));return false});t.on("click",".add_rd",function(t){t.preventDefault();e(this).parent().before(b(false,e(this).parents(".frm-holder").attr("id")));return false});var T=function(){var n=this;if(r.save_url){e.ajax({type:"POST",url:r.save_url,data:e(t).serializeFormList({prepend:r.serialize_prefix})+"&form_id="+f,success:function(){r.saved.call(n)}})}}})}})(jQuery);(function(e){e.fn.serializeFormList=function(t){var n={prepend:"ul",is_child:false,attributes:["class"]};var r=e.extend(n,t);if(!r.is_child){r.prepend="&"+r.prepend}var i="";this.each(function(){var t=this;var n=0;var s=1;e(this).children().each(function(){for(att=0;att<r.attributes.length;att++){var t=r.attributes[att]==="class"?"cssClass":r.attributes[att];i+=r.prepend+"["+n+"]["+t+"]="+encodeURIComponent(e(this).attr(r.attributes[att]));if(r.attributes[att]==="class"){i+=r.prepend+"["+n+"][required]="+encodeURIComponent(e("#"+e(this).attr("id")+" input.required").is(":checked"));switch(e(this).attr(r.attributes[att])){case"input_text":i+=r.prepend+"["+n+"][values]="+encodeURIComponent(e("#"+e(this).attr("id")+" input[type=text]").val());i+=r.prepend+"["+n+"][type]="+encodeURIComponent(e("#"+e(this).attr("id")+" select").val());break;case"textarea":i+=r.prepend+"["+n+"][values]="+encodeURIComponent(e("#"+e(this).attr("id")+" input[type=text]").val());break;case"file":i+=r.prepend+"["+n+"][values]="+encodeURIComponent(e("#"+e(this).attr("id")+" input[type=text]").val());break;case"checkbox":s=1;e("#"+e(this).attr("id")+" input[type=text]").each(function(){if(e(this).attr("name")==="title"){i+=r.prepend+"["+n+"][title]="+encodeURIComponent(e(this).val())}else{i+=r.prepend+"["+n+"][values]["+s+"][value]="+encodeURIComponent(e(this).val());i+=r.prepend+"["+n+"][values]["+s+"][baseline]="+e(this).prev().is(":checked")}s++});break;case"radio":s=1;e("#"+e(this).attr("id")+" input[type=text]").each(function(){if(e(this).attr("name")==="title"){i+=r.prepend+"["+n+"][title]="+encodeURIComponent(e(this).val())}else{i+=r.prepend+"["+n+"][values]["+s+"][value]="+encodeURIComponent(e(this).val());i+=r.prepend+"["+n+"][values]["+s+"][baseline]="+e(this).prev().is(":checked")}s++});break;case"select":s=1;i+=r.prepend+"["+n+"][multiple]="+e("#"+e(this).attr("id")+" input[name=multiple]").is(":checked");e("#"+e(this).attr("id")+" input[type=text]").each(function(){if(e(this).attr("name")==="title"){i+=r.prepend+"["+n+"][title]="+encodeURIComponent(e(this).val())}else{i+=r.prepend+"["+n+"][values]["+s+"][value]="+encodeURIComponent(e(this).val());i+=r.prepend+"["+n+"][values]["+s+"][baseline]="+e(this).prev().is(":checked")}s++});break}}}n++})});return i}})(jQuery)